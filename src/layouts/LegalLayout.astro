---
// src/layouts/LegalLayout.astro
import Layout from './Layout.astro';

/* Utils */
function safeArray(arr, def = []) { return Array.isArray(arr) ? arr : def; }
function safeString(str, def = '') { return typeof str === 'string' ? str : def; }
function safeObject(obj, def = {}) { return obj && typeof obj === 'object' && !Array.isArray(obj) ? obj : def; }

/* Props */
const { data } = Astro.props;
const language = safeString(data?.language, 'es');

/* Datos */
const legalData = safeObject(data);
const legalType = safeString(legalData?.legalType, 'terms'); // 'terms' or 'privacy'
const content = safeObject(legalData?.content);
const sections = safeArray(content?.sections);
const lastUpdated = safeString(legalData?.lastUpdated);
const jurisdiction = safeString(legalData?.jurisdiction);

/* Traducciones */
const text = ({
  es: {
    terms: {
      metaTitle: 'Términos y Condiciones | CLIC',
      metaDescription: 'Lee nuestros términos y condiciones de uso',
      pageTitle: 'Términos y Condiciones',
      pageSubtitle: 'Condiciones de uso del sitio web y servicios',
      lastUpdated: 'Última actualización',
      jurisdiction: 'Jurisdicción',
      accept: 'Al usar nuestros servicios, aceptas estos términos'
    },
    privacy: {
      metaTitle: 'Política de Privacidad | CLIC',
      metaDescription: 'Conoce cómo protegemos tu información personal',
      pageTitle: 'Política de Privacidad',
      pageSubtitle: 'Cómo manejamos y protegemos tu información',
      lastUpdated: 'Última actualización',
      jurisdiction: 'Jurisdicción',
      accept: 'Nos comprometemos a proteger tu privacidad'
    },
    tableOfContents: 'Tabla de Contenidos',
    contact: 'Contacto',
    contactText: '¿Tienes preguntas sobre nuestros términos o políticas?',
    contactButton: 'Contáctanos'
  },
  en: {
    terms: {
      metaTitle: 'Terms and Conditions | CLIC',
      metaDescription: 'Read our terms and conditions of use',
      pageTitle: 'Terms and Conditions',
      pageSubtitle: 'Website and services usage conditions',
      lastUpdated: 'Last updated',
      jurisdiction: 'Jurisdiction',
      accept: 'By using our services, you accept these terms'
    },
    privacy: {
      metaTitle: 'Privacy Policy | CLIC',
      metaDescription: 'Learn how we protect your personal information',
      pageTitle: 'Privacy Policy',
      pageSubtitle: 'How we handle and protect your information',
      lastUpdated: 'Last updated',
      jurisdiction: 'Jurisdiction',
      accept: 'We are committed to protecting your privacy'
    },
    tableOfContents: 'Table of Contents',
    contact: 'Contact',
    contactText: 'Have questions about our terms or policies?',
    contactButton: 'Contact Us'
  },
  fr: {
    terms: {
      metaTitle: 'Termes et Conditions | CLIC',
      metaDescription: 'Lisez nos termes et conditions d\'utilisation',
      pageTitle: 'Termes et Conditions',
      pageSubtitle: 'Conditions d\'utilisation du site web et des services',
      lastUpdated: 'Dernière mise à jour',
      jurisdiction: 'Juridiction',
      accept: 'En utilisant nos services, vous acceptez ces termes'
    },
    privacy: {
      metaTitle: 'Politique de Confidentialité | CLIC',
      metaDescription: 'Découvrez comment nous protégeons vos informations personnelles',
      pageTitle: 'Politique de Confidentialité',
      pageSubtitle: 'Comment nous gérons et protégeons vos informations',
      lastUpdated: 'Dernière mise à jour',
      jurisdiction: 'Juridiction',
      accept: 'Nous nous engageons à protéger votre vie privée'
    },
    tableOfContents: 'Table des Matières',
    contact: 'Contact',
    contactText: 'Des questions sur nos termes ou politiques?',
    contactButton: 'Nous Contacter'
  }
})[language];

const t = text[legalType] || text.terms;

/* SEO */
const rawSeo = safeObject(legalData?.seo);
const safeSeo = {
  title: safeString(rawSeo.title) || t.metaTitle,
  description: safeString(rawSeo.description) || t.metaDescription,
  h1: safeString(rawSeo.h1) || t.pageTitle,
  h2: safeString(rawSeo.h2) || t.pageSubtitle,
  canonical_url: safeString(rawSeo.canonical_url, ''),
  ogImage: safeString(rawSeo.ogImage, '/og-legal.jpg'),
  keywords: safeString(rawSeo.keywords),
  hreflang: safeObject(rawSeo.hreflang),
  breadcrumbs: safeArray(rawSeo.breadcrumbs, []),
  robots: 'noindex, follow' // Legal pages typically don't need indexing
};

/* Layout props */
const layoutProps = {
  title: safeSeo.title,
  description: safeSeo.description,
  ogImage: safeSeo.ogImage,
  canonical: safeSeo.canonical_url,
  keywords: safeSeo.keywords,
  robots: safeSeo.robots,
  hreflangData: safeSeo.hreflang || {},
  globalConfig: legalData?.globalConfig || {},
  language,
  trackingString: legalData?.trackingString || '',
  country: legalData?.country || {},
  breadcrumbs: safeSeo.breadcrumbs
};

/* Obtener datos reales del backend */
const backendSections = safeArray(sections);

/* Fallback demo content solo si no hay datos del backend */
const demoSections = legalType === 'terms' ? [
  {
    title: language === 'es' ? '1. Aceptación de los Términos' : language === 'en' ? '1. Acceptance of Terms' : '1. Acceptation des Termes',
    content: language === 'es'
      ? 'Al acceder y utilizar este sitio web, usted acepta estar sujeto a estos términos y condiciones de uso, todas las leyes y regulaciones aplicables, y acepta que es responsable del cumplimiento de todas las leyes locales aplicables.'
      : language === 'en'
      ? 'By accessing and using this website, you agree to be bound by these terms and conditions of use, all applicable laws and regulations, and agree that you are responsible for compliance with any applicable local laws.'
      : 'En accédant et en utilisant ce site web, vous acceptez d\'être lié par ces termes et conditions d\'utilisation, toutes les lois et réglementations applicables, et acceptez que vous êtes responsable du respect de toutes les lois locales applicables.'
  },
  {
    title: language === 'es' ? '2. Uso del Sitio' : language === 'en' ? '2. Use of Site' : '2. Utilisation du Site',
    content: language === 'es'
      ? 'Este sitio web y su contenido son para su información general y uso personal. Está sujeto a cambios sin previo aviso.'
      : language === 'en'
      ? 'This website and its content are for your general information and personal use. It is subject to change without notice.'
      : 'Ce site web et son contenu sont pour votre information générale et votre usage personnel. Il est sujet à changement sans préavis.'
  },
  {
    title: language === 'es' ? '3. Propiedad Intelectual' : language === 'en' ? '3. Intellectual Property' : '3. Propriété Intellectuelle',
    content: language === 'es'
      ? 'Este sitio web contiene material que es propiedad de CLIC Inmobiliaria o está bajo licencia. Este material incluye, pero no se limita a, el diseño, la apariencia y los gráficos.'
      : language === 'en'
      ? 'This website contains material which is owned by or licensed to CLIC Inmobiliaria. This material includes, but is not limited to, the design, layout, look, appearance and graphics.'
      : 'Ce site web contient du matériel qui appartient à ou est sous licence de CLIC Inmobiliaria. Ce matériel comprend, mais sans s\'y limiter, la conception, la mise en page, l\'apparence et les graphiques.'
  }
] : [
  {
    title: language === 'es' ? '1. Recopilación de Información' : language === 'en' ? '1. Information Collection' : '1. Collecte d\'Informations',
    content: language === 'es'
      ? 'Recopilamos información que usted nos proporciona directamente cuando crea una cuenta, completa un formulario, se comunica con nosotros o utiliza nuestros servicios.'
      : language === 'en'
      ? 'We collect information that you provide directly to us when you create an account, fill out a form, contact us, or use our services.'
      : 'Nous collectons les informations que vous nous fournissez directement lorsque vous créez un compte, remplissez un formulaire, nous contactez ou utilisez nos services.'
  },
  {
    title: language === 'es' ? '2. Uso de la Información' : language === 'en' ? '2. Use of Information' : '2. Utilisation des Informations',
    content: language === 'es'
      ? 'Utilizamos la información que recopilamos para proporcionar, mantener y mejorar nuestros servicios, procesar transacciones y enviarle información relacionada.'
      : language === 'en'
      ? 'We use the information we collect to provide, maintain, and improve our services, process transactions, and send you related information.'
      : 'Nous utilisons les informations que nous collectons pour fournir, maintenir et améliorer nos services, traiter les transactions et vous envoyer des informations connexes.'
  },
  {
    title: language === 'es' ? '3. Protección de Datos' : language === 'en' ? '3. Data Protection' : '3. Protection des Données',
    content: language === 'es'
      ? 'Implementamos medidas de seguridad técnicas y organizativas apropiadas para proteger su información personal contra el acceso no autorizado, alteración, divulgación o destrucción.'
      : language === 'en'
      ? 'We implement appropriate technical and organizational security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.'
      : 'Nous mettons en œuvre des mesures de sécurité techniques et organisationnelles appropriées pour protéger vos informations personnelles contre l\'accès non autorisé, l\'altération, la divulgation ou la destruction.'
  }
];

/* Usar datos reales si existen, sino demo */
const displaySections = backendSections.length > 0 ? backendSections : demoSections;
---

<Layout {...layoutProps}>
  <div class="legal-layout bg-gray-50">

    <!-- HERO -->
    <section class="py-12 bg-gradient-to-r from-gray-900 to-gray-800 text-white">
      <div class="container mx-auto px-4">
        <h1 class="text-3xl md:text-4xl font-bold mb-3">{safeSeo.h1}</h1>
        <p class="text-lg md:text-xl opacity-90 mb-4">{safeSeo.h2}</p>

        <div class="flex flex-wrap gap-4 text-sm opacity-80">
          {lastUpdated && (
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <span>{t.lastUpdated}: {lastUpdated || 'Enero 2025'}</span>
            </div>
          )}
          {jurisdiction && (
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <span>{t.jurisdiction}: {jurisdiction || 'República Dominicana'}</span>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- CONTENT -->
    <section class="py-12">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">

          <!-- Table of Contents -->
          {displaySections.length > 3 && (
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
              <h2 class="text-xl font-bold mb-4">{text.tableOfContents}</h2>
              <ul class="space-y-2">
                {displaySections.map((section, index) => (
                  <li>
                    <a
                      href={`#section-${index}`}
                      class="text-[#f04e00] hover:underline"
                    >
                      {section.title}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )}

          <!-- Accept Notice -->
          <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r-lg">
            <p class="text-gray-800">{t.accept}</p>
          </div>

          <!-- Sections -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
            {displaySections.map((section, index) => (
              <div id={`section-${index}`} class="mb-8 last:mb-0">
                <h2 class="text-2xl font-bold mb-4 text-gray-900">{section.title}</h2>
                <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed">
                  {section.content}
                </div>
              </div>
            ))}
          </div>

        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="py-12 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-2xl mx-auto text-center">
          <h3 class="text-2xl font-bold mb-4">{text.contact}</h3>
          <p class="text-gray-600 mb-6">{text.contactText}</p>
          <a
            href="/contacto"
            class="inline-block px-8 py-3 bg-[#f04e00] text-white font-semibold rounded-lg hover:bg-[#e03d00] transition-all duration-300 transform hover:scale-105"
          >
            {text.contactButton}
          </a>
        </div>
      </div>
    </section>

  </div>
</Layout>
